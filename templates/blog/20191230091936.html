<ol class="bread" itemscope itemtype="http://schema.org/BreadcrumbList">
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/">
        <span itemprop="name">Perl</span></a>
    <meta itemprop="position" content="1" />
  </li>
  &#8250;
  <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
    <a itemprop="item" href="/blog/20191228171433.html">
      <span itemprop="name">帳票作成</span></a>
    <meta itemprop="position" content="2" />
  </li>
  &#8250;
  <li>
    here
  </li>
</ol>

<h2>テキストを描画する  - PDF::API2で帳票作成</h2>

PDF::API2で、PDFにテキストを描画するには、次のようにします。

<pre>
use PDF::API2;

my $pdf = PDF::API2->new;

my $page = $pdf->page;

# コアフォントの読み込み
my $font = $pdf->corefont('Helvetica-Bold');

# テキストを表現するコンテンツオブジェクトを取得
my $text = $page->text();

# フォントを設定
$text->font($font, 11);

# 描画位置を設定(原点は、左下。デフォルトでは、ページの幅が612単位、高さが792単位)
$text->translate(30, 750);

# テキストを描画
$text->text('Hello World!');

my $pdf_file = 'text_core_font.pdf';
$pdf->saveas($pdf_file);
</pre>

<b>フォントオブジェクトの取得</b>

PDF::API2では、フォントを表現するフォントオブジェクトをcorefontメソッドあるいはttfontメソッドを使って取得します。ここでは、corefontオブジェクトを使って描画しています。

<pre>
# コアフォントの読み込み
my $font = $pdf->corefont('Helvetica-Bold');
</pre>

コアフォントを取得するにはcorefontメソッドを使います。注意点としては、corefontでは、日本語が描画できないことに注意してください。日本語を利用したい場合は、ttfontで日本語をサポートするトゥルータイプフォントを、指定する必要があります。

<b>テキストを表現するコンテンツオブジェクト</b>

PDF::API2では、テキストを表現するコンテンツオブジェクトをページオブジェクトのtextメソッドを使って取得します。ここでは、テキストを表現するコンテンツオブジェクトをテキストオブジェクトと呼びます。

<pre>
# テキストを表現するコンテンツオブジェクトを取得
my $text = $page->text();
</pre>

<b>フォントの設定</b>

PDF::API2では、テキストオブジェクトのfontメソッドで、フォントを設定します。

<pre>
# フォントを設定
$text->font($font, 11);
</pre>

<b>描画位置の指定</b>

PDF::API2では、テキストオブジェクトのtranslateメソッドで描画位置を設定します。

<pre>
# 描画位置を設定(原点は、左下。デフォルトでは、ページの幅が612単位、高さが792単位)
$text->translate(30, 750);
</pre>

原点は、左下。デフォルトでは、ページの幅が612単位、高さが792単位です。PDF座標については、<a href="/blog/20191226175520.html">PDFファイルを作成する</a>の「用紙サイズを設定する」の解説を見てください。

注意点としては、ページの余白やテキストの行数などの設定などはできず、描画位置は、translateメソッドで指定する必要があることです。描画位置を自分で計算して指定する必要があることに注意してください。

<b>テキストの描画</b>

PDF::API2では、テキストオブジェクトのtextメソッドでテキストを描画します。

<pre>
# テキストを描画
$text->text('Hello World!');
</pre>

テキストを描画すると、現在の描画位置のx座標がテキストの終端まで移動します。この位置は、textposメソッドで取得できます。

<h3>アンダーラインを描画</h3>

PDF::API2でテキストにアンダーラインを描画するにはtextメソッドの「-underline」オプションを指定します。「auto」で自動的にアンダーラインの位置が決まります。

<pre>
# アンダーラインを描画
$text->text('Hello World!', -underline => 'auto');
</pre>

<h3>テキストを指定位置を中心として描画</h3>

PDF::API2でテキストを指定位置を中心として描画するには、text_centerメソッドを使用します。オプションは、textメソッドと同一です。

<pre>
# アンダーラインを描画
$text->text_center('Hello World!');
</pre>

ページの見出しなどを画面の中央に表示したい場合などに利用できます。

<h3>テキストを指定位置を右端として描画</h3>

PDF::API2でテキストを指定位置を右端として描画として描画するには、text_rightメソッドを使用します。オプションは、textメソッドと同一です。

ページ番号などの、右下に表示したい場合などに利用できます。

<pre>
# アンダーラインを描画
$text->text_right('Hello World!');
</pre>

<h3>現在のテキストの描画位置を取得する</h3>

PDF::API2で現在のテキストの描画位置を取得するには、textposメソッドを使用します。

<pre>
# 現在のテキストの描画位置を取得
my ($x, $y) = $text->textpos();
</pre>

この値を使って、改行すべき位置をチェックしたり、改ページすべき位置をチェックすることができます。

<h3>フォントサイズを取得する</h3>

既存のテキストのフォントサイズを取得するには、textstateメソッドを引数なしで呼び出し、テキストの状態を表現するハッシュが返されるので、fontsizeの値を取り出します。

<pre>
# 既存のテキストのフォントサイズを取得
my %text_state = $text->textstate;
my $font_size = $text_state{fontsize};
</pre>

<h3>テキストの高さを取得する</h3>

テキストの高さは、実は、フォントサイズと同じです。フォントサイズ16は、PDF単位の16と同じです。改行をする場合は、フォントサイズの幅で改行すれば、重なることがありません。

<pre>
my $font_size = 16;
my $text_height = $font_size;
</pre>

<h3>行の高さ</h3>

行と行の間は行間が少し空いていますね。行の高さは、テキストの高さに、行間の幅を加えたものになります。フォントサイズ(テキストの高さ)が11で、行間が2だとすると、行の高さは、13となります。

<pre>
# フォントサイズ(テキストの高さ)
my $font_size = 16;
my $text_height = $font_size;

# 行間
my $line_margin = 2;

# 行の高さ
my $line_height = $text_height + $line_margin;
</pre>

例えば、改行をして、移動するときは、行の高さを減算してあげればよいです。

<h3>余白の設定</h3>

PDF::API2を使う場合は、ページに余白を設定したい場合は、GUIでの画面のように、余白の値を設定することはできません。自分で計算する必要があります。

ただしデメリットばかりではなく、この方法を覚えておくと、奇数ページと偶数ページで、余白を変えたりと、非常に柔軟性があります。

<h4>PDF単位とインチとmmの関係</h4>

まず最初にPDFで指定されるPDF単位とインチとmmの関係を覚えましょう。

PDFの1単位は、1/72インチです。

1インチは、25.4mmです。

PDFの1単位は、mmに換算すると約0.352777777777778mmです。割り切れません。

PDFの3単位は、mmに換算すると約1.05833333333333mmです。割り切れません。

PDFの9単位は、mmに換算すると、3.175mmです。

PDFの3単位が1mmに近いですね。9単位がきりが良いです。

余白をだいたい12mm～13mmにしたいとすれば、PDF単位の36を使います。考え方としては、PDFの9単位は、mmに換算すると、3.175mmですから、これに4をかけると、36単位で、12.7mmとなります。

ここでの解説は、上下左右のすべての余白が36単位であるとします。

<pre>
# ページ上余白
my $page_top_margin = 36;

# ページ下余白
my $page_bottom_margin = 36;

# ページ左余白
my $page_left_margin = 36;

# ページ右余白
my $page_right_margin = 36;
</pre>

上下余白については、フォントのベースラインが基準になりますので、見た目よりも、すこし文字がはみ出ることに注意してください。

<h4>描画開始位置と描画終了位置</h4>

余白を考える場合は、描画の開始位置のXY座標と、描画終了位置のXY座標を計算で求める必要があります。

まず、用紙サイズの幅を取得しましょう。(参考:<a href="/blog/20191226175520.html">PDFファイルを作成する</a>の用紙サイズを取得する)

<pre>
# 用紙サイズの幅と高さを取得
my @page_size_infos = $page->mediabox;
my $page_width = $page_size_infos[2];
my $page_height = $page_size_infos[3];
</pre>

PDFの座標は、左下から始まるということを、意識しておきましょう。これが、典型的なPDFドキュメントとすると、ページの幅が、612単位、高さが792単位ですので、ページの左上の座標は(0, 791)です。(0, 0)ではないので注意してください。

x座標は、そのまま計算できますが、y座標は、ページの高さから減算して求める必要があります。

描画開始位置のxy座標と、描画終了位置のxy座標を計算して求めると次のようになります。

<pre>
# 描画開始x座標
my $render_start_x = 0;

# 描画開始y座標
my $render_start_y = $page_height - 1;

# 描画終了x座標
my $render_end_x = $page_width - 1;

# 描画終了y座標 = 0;
my $render_end_y = 0;
</pre>









<h3>フォントとは</h3>

https://fontnavi.jp/zakkuri/105-font_for_mac_win.aspx
